<!DOCTYPE html>
<html lang="de" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
</head>
<body>
        <h1>User Profile</h1>

        <form
                th:action="@{profile/save-image}"
                th:object="${appuser}"
                method="POST"
                enctype="multipart/form-data">

            <div>
                <label>Add profile picture</label>
                <br>
                <input type="file" name="image" accept="image/png, image/jpeg" required/>
            </div>
            <button type="submit">Add picture</button>
        </form>

        <img th:src="@{'profile/image/' + ${appuser.appuser_id}}"/>

        <label>Username: </label>
        <p th:text="${appuser.username}"></p>

        <label>Vorname: </label>
        <p th:text="${appuser.firstname}"></p>

        <label>Nachname: </label>
        <p th:text="${appuser.lastname}"></p>

        <label>Email: </label>
        <p th:text="${appuser.email}"></p>

    <br>
    <a href="/user/logout">Logout</a>
    <a href="/">Home</a>
    <br>

    <form
            th:action="@{profile/save-training}"
            method="POST">

        <div>
            <label>Title</label>
            <div>
                <input type="text" id="titel" name="title"  placeholder="" required>
            </div>
        </div>

        <div>
            <label>Beschreibung</label>
            <div>
                <input type="text" id="description" name="description"  placeholder="" required>
            </div>
        </div>

        <div>
            <label>Preis</label>
            <div>
                <input type="number" id="preis" name="price" placeholder="" required>
            </div>
        </div>
        <div>
            <label>Datum</label>
            <div>
                <input type="date" pattern="\d{4}-\d{2}-\d{2}" id="date" name="date" placeholder="" required>
            </div>
        </div>

        <div>
            <label>Beginnzeit</label>
            <div>
                <input type="time" pattern="\d{4}-\d{2}-\d{2}" id="beginn_time" name="beginntime" placeholder="" required>
            </div>
        </div>

        <div>
            <label>Endzeit</label>
            <div>
                <input type="time" pattern="\d{4}-\d{2}-\d{2}" id="end_time" name="endtime" placeholder="" required>
            </div>
        </div>

        <div>
            <label>Standort</label>
            <br>
            <button type="button" onclick="getLocation()">Derzeitigen Standort verwenden</button>
            <br>
            <p id="msg"></p>
            <input type="hidden" id="latitude" name="latitude" placeholder="">
            <input type="hidden" id="longitude" name="longitude" placeholder="">
            <input type="text" id="location-name" name="location-name" placeholder="Optional: Adresse">
        </div>


        <button type="submit">Add Training</button>
    </form>


    <table>
        <thead>
        <tr>
            <th scope="col">Training</th>
            <th scope="col">Beschreibung</th>
            <th scope="col">Preis</th>
            <th scope="col">Datum</th>
            <th scope="col">Standort</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="training: ${trainings}">
            <th th:text="${training.titel}"></th>
            <td th:text="${training.description}"></td>
            <td th:text="${training.price + '€'}"></td>
            <td th:text="${#dates.format(training.date, 'dd.MM.yyyy')}"></td>
            <td th:text="${training.location.getName().toString()}"></td>
        </tr>
        </tbody>
    </table>


    <script>
        var x = document.getElementById("msg");

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getPosition, showError);
            } else {
                x.innerHTML = "Geolocation wird vom Browser nicht unterstützt.";
            }
        }

        function getPosition(position) {
            document.getElementById("latitude").value = position.coords.latitude;
            document.getElementById("longitude").value = position.coords.longitude;
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    x.innerHTML = "Benutzer hat anfrage für Geolocation zurückgewiesen."
                    break;
                case error.POSITION_UNAVAILABLE:
                    x.innerHTML = "Kein Standort gefunden."
                    break;
                case error.TIMEOUT:
                    x.innerHTML = "Zeitüberschreitung der Anfrage."
                    break;
                case error.UNKNOWN_ERROR:
                    x.innerHTML = "Ein unbekannter fehler ist aufgetreten"
                    break;
            }
        }
    </script>
    </body>
</html>